{% extends "layout.html" %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h2 class="h5">出退勤データの編集</h2>
    
    <div class="alert alert-info">
      <strong>監査記録について:</strong> この編集操作は監査ログに記録され、変更前後の値が保存されます。
    </div>
    
    <form method="POST" class="mt-3">
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
      
      <div class="mb-3">
        <label class="form-label">ユーザー</label>
        <input type="text" class="form-control" value="{{ shift.user.name }} ({{ shift.user.email }})" disabled>
      </div>
      
      <div class="mb-3">
        <label class="form-label">出勤時刻 ({{ LOCAL_TZ_NAME }})</label>
        <input type="datetime-local" class="form-control" name="clock_in_at" 
               value="{% if clock_in_local %}{{ clock_in_local.strftime('%Y-%m-%dT%H:%M') }}{% endif %}"
               step="60">
        <small class="form-text text-muted">
          {% if shift.clock_in_at %}
          UTC: {{ shift.clock_in_at.isoformat() }}<br>
          IP: {{ shift.clock_in_ip or '-' }} | UA: {{ (shift.clock_in_ua or '-')[:50] }}
          {% else %}
          未設定
          {% endif %}
        </small>
      </div>
      
      <div class="mb-3">
        <label class="form-label">退勤時刻 ({{ LOCAL_TZ_NAME }})</label>
        <input type="datetime-local" class="form-control" name="clock_out_at"
               value="{% if clock_out_local %}{{ clock_out_local.strftime('%Y-%m-%dT%H:%M') }}{% endif %}"
               step="60">
        <small class="form-text text-muted">
          {% if shift.clock_out_at %}
          UTC: {{ shift.clock_out_at.isoformat() }}<br>
          IP: {{ shift.clock_out_ip or '-' }} | UA: {{ (shift.clock_out_ua or '-')[:50] }}
          {% else %}
          未設定（出勤中の可能性があります）
          {% endif %}
        </small>
      </div>
      
      <div class="mb-3">
        <label class="form-label">現在の実働時間</label>
        <input type="text" class="form-control" value="{{ shift.worked_seconds()|fmt_hms }}" disabled>
        <small class="form-text text-muted">休憩時間を除いた実働時間</small>
      </div>
      
      <div class="mb-3">
        <label class="form-label">休憩回数</label>
        <input type="text" class="form-control" value="{{ shift.breaks|length }}回" disabled>
      </div>
      
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">更新</button>
        <a href="{{ url_for('admin') }}" class="btn btn-secondary">キャンセル</a>
      </div>
    </form>
    
    <div class="mt-4">
      <h3 class="h6">編集履歴</h3>
      <p class="text-muted small">
        編集操作はすべて監査ログ（audit_logs）に記録されます。<br>
        管理画面の監査ログで変更履歴を確認できます。
      </p>
    </div>
  </div>
</div>
{% endblock %}

