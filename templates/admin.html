{% extends "layout.html" %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h2 class="h5">管理 - 出退勤記録</h2>
    <form class="row row-cols-lg-auto g-2 align-items-end mt-2">
      <div class="col-12">
        <label class="form-label">開始日</label>
        <input type="date" class="form-control" name="start" value="{{ start }}">
      </div>
      <div class="col-12">
        <label class="form-label">終了日</label>
        <input type="date" class="form-control" name="end" value="{{ end }}">
      </div>
      <div class="col-12">
        <label class="form-label">メール（任意）</label>
        <input type="email" class="form-control" name="email" value="{{ user_email }}">
      </div>
      <div class="col-12">
        <button class="btn btn-primary">適用</button>
        <a class="btn btn-outline-secondary" href="{{ url_for('admin_export', start=start, end=end, email=user_email) }}">CSVエクスポート</a>
      </div>
    </form>

    <div class="table-responsive mt-3">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th>ユーザー</th>
            <th>出勤</th>
            <th>退勤</th>
            <th>休憩(数/合計)</th>
            <th>実働</th>
            <th>IP (in/out)</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {% for s in shifts %}
          <tr>
            <td>{{ s.user.name }}<br><span class="text-muted small">{{ s.user.email }}</span></td>
            <td>{{ s.clock_in_at|fmt_dt }}</td>
            <td>{{ s.clock_out_at|fmt_dt }}</td>
            <td>{{ s.breaks|length }} / {{ s.total_break_seconds()|fmt_hms }}</td>
            <td>{{ s.worked_seconds()|fmt_hms }}</td>
            <td class="small">{{ s.clock_in_ip or '-' }}<br>{{ s.clock_out_ip or '-' }}</td>
            <td><a href="{{ url_for('admin_shift_edit', shift_id=s.id) }}" class="btn btn-sm btn-outline-primary">編集</a></td>
          </tr>
          {% else %}
          <tr><td colspan="7" class="text-muted">該当なし</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p class="text-muted small mb-0">
      * 保存はUTC、表示は {{ LOCAL_TZ_NAME }}。<br>
      * 各操作は監査ログ（IP/UA/HMAC）に記録されます。
    </p>
  </div>
</div>
{% endblock %}
